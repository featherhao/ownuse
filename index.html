<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>TVBox → MoonTV 转换器</title>
<style>
body{font-family:Arial;margin:40px}
input{width:100%;max-width:500px;padding:10px;margin-bottom:10px;font-size:16px}
button{padding:5px 10px;margin-left:5px;font-size:14px;cursor:pointer}
.result{margin-top:20px;word-break:break-all}
pre{background:#f0f0f0;padding:10px;border-radius:5px;overflow-x:auto}
.link-group{margin-bottom:10px}
h2{color:#333}
</style>
</head>
<body>
<h1>TVBox → MoonTV JSON 转换器</h1>
<input id="urlInput" placeholder="请输入 TVBox JSON URL" />
<div class="result" id="result"></div>
<script>
const input=document.getElementById('urlInput')
const resultDiv=document.getElementById('result')
const workerBase='https://<你的Worker域名>/'

function createCopyButton(text){const btn=document.createElement('button');btn.textContent='复制';btn.onclick=()=>navigator.clipboard.writeText(text).then(()=>alert('已复制到剪贴板'));return btn}

async function update() {
  const url=input.value.trim()
  resultDiv.textContent=''
  if(!url) return

  // Worker 链接
  const workerUrl=workerBase+'?type=api&url='+encodeURIComponent(url)
  const div=document.createElement('div')
  div.className='link-group'
  div.appendChild(document.createTextNode('Worker 链接: '))
  div.appendChild(document.createElement('a'))
  div.querySelector('a').href=workerUrl
  div.querySelector('a').target='_blank'
  div.querySelector('a').textContent=workerUrl
  div.appendChild(createCopyButton(workerUrl))
  resultDiv.appendChild(div)

  try {
    const res=await fetch(workerUrl)
    const encoded=await res.text()
    const pre=document.createElement('pre')
    pre.textContent=encoded
    resultDiv.appendChild(pre)
  } catch(e) {
    resultDiv.textContent='错误: '+e.message
  }
}

input.addEventListener('input',()=>setTimeout(update,500))

// 如果 URL 带 ?prefill=xxx
const params=new URLSearchParams(window.location.search)
if(params.has('prefill')) {
  input.value=params.get('prefill')
  update()
}
</script>
</body>
</html>
