<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>常用工具集合</title>
<style>
body{font-family:Arial;margin:40px}
input,textarea{width:100%;max-width:500px;padding:10px;margin-bottom:10px;font-size:16px}
button{padding:5px 10px;margin-left:5px;font-size:14px;cursor:pointer}
.result{margin-top:20px;word-break:break-all}
li{margin-bottom:8px}
</style>
</head>
<body>
<h1>常用工具集合</h1>

<div id="adminSection">
  <input type="password" id="adminPassword" placeholder="管理员密码"/>
  <button id="adminLogin">管理员登录</button>
  <span id="adminStatus" style="color:green"></span>
</div>

<h2>添加工具</h2>
<input id="nameInput" placeholder="工具名称"/>
<input id="urlInput" placeholder="工具链接"/>
<button id="addBtn">添加工具</button>

<h2>工具列表</h2>
<ul id="toolList"></ul>

<script>
let tools = []
let isAdmin = false
const listEl = document.getElementById('toolList')
const nameInput = document.getElementById('nameInput')
const urlInput = document.getElementById('urlInput')
const addBtn = document.getElementById('addBtn')
const adminLoginBtn = document.getElementById('adminLogin')
const adminStatus = document.getElementById('adminStatus')

async function loadTools(){
  const res = await fetch('/api/tools')
  tools = await res.json()
  renderTools()
}

function renderTools(){
  listEl.innerHTML = ''
  tools.forEach((t,i)=>{
    const li = document.createElement('li')
    const nameLink = document.createElement('a')
    nameLink.href=t.url
    nameLink.target='_blank'
    nameLink.textContent=t.name
    li.appendChild(nameLink)

    const descSpan = document.createElement('span')
    descSpan.textContent = t.desc ? ` - ${t.desc}` : ''
    li.appendChild(descSpan)

    if(isAdmin){
      const editBtn = document.createElement('button')
      editBtn.textContent='编辑说明'
      editBtn.onclick = async ()=>{
        const newDesc = prompt('请输入工具说明', t.desc||'')
        if(newDesc!==null){
          const res = await fetch('/api/tools', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ action:'edit', index:i, desc:newDesc, password: document.getElementById('adminPassword').value })
          })
          const data = await res.json()
          if(data.success) loadTools()
          else alert('编辑失败: '+(data.message||'未知错误'))
        }
      }
      li.appendChild(editBtn)

      const delBtn = document.createElement('button')
      delBtn.textContent='删除'
      delBtn.onclick=async ()=>{
        if(confirm('确定删除吗？')){
          const res = await fetch('/api/tools',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({action:'delete', index:i, password:document.getElementById('adminPassword').value})
          })
          const data = await res.json()
          if(data.success) loadTools()
          else alert('删除失败: '+(data.message||'未知错误'))
        }
      }
      li.appendChild(delBtn)
    }
    listEl.appendChild(li)
  })
}

addBtn.addEventListener('click', async ()=>{
  if(!isAdmin) return alert('请先登录管理员')
  const name = nameInput.value.trim()
  const url = urlInput.value.trim()
  const desc = prompt('请输入使用说明','')
  if(!name || !url) return alert('请填写完整')
  const res = await fetch('/api/tools', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'add', name, url, desc, password: document.getElementById('adminPassword').value })
  })
  const data = await res.json()
  if(data.success){
    nameInput.value=''; urlInput.value=''
    loadTools()
  } else alert('添加失败：'+(data.message||'未知错误'))
})

adminLoginBtn.addEventListener('click',()=>{
  isAdmin = true
  adminStatus.textContent=' 已登录'
  loadTools()
})

loadTools()
</script>
</body>
</html>
