<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>常用工具集合</title>
<style>
body{font-family:Arial;margin:40px}
h1{color:#333}
ul{list-style:none;padding:0}
li{margin-bottom:10px}
a{color:#0066cc;text-decoration:none}
a:hover{text-decoration:underline}
#adminPanel{display:none;margin-top:20px}
button{margin-left:5px;padding:3px 6px;font-size:12px;cursor:pointer}
</style>
</head>
<body>
<h1>常用工具集合</h1>
<ul id="toolsList"></ul>

<div id="loginPanel">
  <h2>管理员登录</h2>
  <input type="password" id="adminPassword" placeholder="请输入管理员密码" />
  <button id="loginBtn">登录</button>
  <div id="loginMsg" style="color:red;margin-top:5px"></div>
</div>

<div id="adminPanel">
  <h2>添加新工具</h2>
  <input id="toolName" placeholder="工具名称" />
  <input id="toolUrl" placeholder="工具链接" />
  <button id="addToolBtn">添加工具</button>
</div>

<script>
const listEl = document.getElementById('toolsList')
const loginPanel = document.getElementById('loginPanel')
const adminPanel = document.getElementById('adminPanel')
const loginBtn = document.getElementById('loginBtn')
const loginMsg = document.getElementById('loginMsg')
const nameInput = document.getElementById('toolName')
const urlInput = document.getElementById('toolUrl')
const addBtn = document.getElementById('addToolBtn')

let isAdmin = false
let tools = []

async function loadTools(){
  const res = await fetch('/api/tools')
  tools = await res.json()
  renderTools()
}

function renderTools(){
  listEl.innerHTML = ''
  tools.forEach((t,i)=>{
    const li = document.createElement('li')
    const a = document.createElement('a')
    a.href=t.url
    a.target='_blank'
    a.textContent=t.name
    li.appendChild(a)
    if(isAdmin){
      const delBtn = document.createElement('button')
      delBtn.textContent='删除'
      delBtn.onclick=()=>deleteTool(i)
      li.appendChild(delBtn)
    }
    listEl.appendChild(li)
  })
}

// 登录验证
loginBtn.addEventListener('click', async ()=>{
  const password = document.getElementById('adminPassword').value
  if(!password) return

  const res = await fetch('/api/tools', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'login', password })
  })
  const data = await res.json()
  if(data.success){
    isAdmin = true
    loginPanel.style.display='none'
    adminPanel.style.display='block'
    alert('登录成功')
    renderTools()
  } else {
    loginMsg.textContent = '密码错误'
  }
})

// 添加新工具
addBtn.addEventListener('click', async ()=>{
  if(!isAdmin) return alert('请先登录管理员')

  const name = nameInput.value.trim()
  const url = urlInput.value.trim()
  if(!name || !url) return alert('请填写完整')

  const res = await fetch('/api/tools', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'add', name, url, password: document.getElementById('adminPassword').value })
  })
  const data = await res.json()
  if(data.success){
    alert('添加成功')
    nameInput.value=''; urlInput.value=''
    loadTools()
  } else {
    alert('添加失败：'+(data.message||'未知错误'))
  }
})

// 删除工具
async function deleteTool(index){
  if(!isAdmin) return
  const tool = tools[index]
  const res = await fetch('/api/tools', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'delete', index, password: document.getElementById('adminPassword').value })
  })
  const data = await res.json()
  if(data.success){
    alert('删除成功')
    loadTools()
  } else {
    alert('删除失败：'+(data.message||'未知错误'))
  }
}

loadTools()
</script>
</body>
</html>
